clear all; close all hidden; clc;

wn = pi;
k = 1;
b = 0.01;
q = tf('q');
H = (wn^2*k)/(q^2 + 2*b*wn*q + wn^2);
H

w_vect = linspace(0,pi,1000);
Fresp = squeeze(freqresp(H,w_vect));

f1 = figure();
set(f1,'position',[900 550 450 400]);
subplot(211)
plot(w_vect,(abs(Fresp)));
xlim([0 pi]);
xlabel("Frequency rad/s");
ylabel("Magnitude");
grid on;
subplot(212)
plot(w_vect,angle(Fresp));
xlim([0 pi]);
xlabel("Frequency rad/s");
ylabel("Phase");
grid on;
sgtitle("Bode plot H filter");

f2 = figure();
set(f2,'position',[1400 550 450 400]);
bode(H);
grid on;

N = 2^16;
r = zeros(1,N);

[u,y] = assignment_sys_25(r);

WINDOW = hann(N/256);
[Pxx,W] = pwelch(y,WINDOW);

f3 = figure();
set(f3,'position',[900 50 450 400]);
plot(W,Pxx);
grid on;
xlabel('frequency');
ylabel('Magnitude');
title('Welch Power Spectral Density Estimate of H_0(q)');
xlim([0 pi]);

f4 = figure();
set(f4,'position',[1400 50 450 400]);
semilogx(W,20*log10(abs(Pxx)));
grid on;
xlabel('frequency');
ylabel('Magnitude [db]');
title('Welch Power Spectral Density Estimate of H_0(q)');
xlim([0 pi]);
%tfest(iddata(y,u));